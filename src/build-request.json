{
  "kind": "build_request",
  "title": "Fix file not found error on shared file links",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Investigate and fix the issue where uploaded files return 'File not found' error when accessed via their share links",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1",
          "msg-2",
          "msg-3"
        ],
        "quotes": [
          "File not found. The share link may be invalid or the file may have been deleted.",
          "how long does it take before the uploaded file is available over the link?",
          "uploaded files are showing \"File not found\" when accessed via their share links"
        ]
      },
      "acceptanceCriteria": [
        "Uploaded files are immediately accessible via their share links after upload completes",
        "The SharePage displays the uploaded file correctly without 'File not found' error",
        "Share link generation correctly references the stored file ID",
        "Public file retrieval endpoint returns the correct file data for valid share IDs"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Verify that the file upload flow correctly stores file metadata and chunks in the backend persistent maps",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-2",
          "msg-3"
        ]
      },
      "acceptanceCriteria": [
        "File metadata is stored in the files map with correct ID",
        "File chunks are stored in the fileChunks map and associated with the correct file ID",
        "Upload finalization confirms all chunks are present before marking file as complete"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Ensure the share link generation uses the correct file ID format that matches how files are stored and retrieved",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-2",
          "msg-3"
        ]
      },
      "acceptanceCriteria": [
        "Share link URL contains the correct file ID parameter",
        "Frontend shareLinks utility generates URLs that match the backend's expected format",
        "SharePage correctly extracts the file ID from the URL and passes it to the retrieval query"
      ]
    },
    {
      "id": "REQ-4",
      "text": "Fix any issues with the public file access permissions that prevent anonymous users from viewing shared files",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-2"
        ]
      },
      "acceptanceCriteria": [
        "Shared files with isShared=true are accessible without authentication",
        "The getFileMetadata and getFileChunk methods correctly handle public access for shared files",
        "Authorization checks allow anonymous access to shared files while protecting private files"
      ]
    }
  ],
  "constraints": [
    "Do not modify the Internet Identity authentication hooks or components",
    "Preserve the existing chunked upload mechanism and file size limits",
    "Maintain the single-actor backend architecture"
  ],
  "nonGoals": [
    "Adding new file sharing features beyond fixing the current broken flow",
    "Changing the UI design or layout of the SharePage",
    "Modifying file upload size limits or chunk sizes"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}